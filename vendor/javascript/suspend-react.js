// suspend-react@0.1.3 downloaded from https://ga.jspm.io/npm:suspend-react@0.1.3/index.js

const isPromise=e=>"object"===typeof e&&"function"===typeof e.then;const e=[];function shallowEqualArrays(e,r,t=((e,r)=>e===r)){if(e===r)return true;if(!e||!r)return false;const o=e.length;if(r.length!==o)return false;for(let s=0;s<o;s++)if(!t(e[s],r[s]))return false;return true}function query(r,t=null,o=false,s={}){null===t&&(t=[r]);for(const r of e)if(shallowEqualArrays(t,r.keys,r.equal)){if(o)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response")){if(s.lifespan&&s.lifespan>0){r.timeout&&clearTimeout(r.timeout);r.timeout=setTimeout(r.remove,s.lifespan)}return r.response}if(!o)throw r.promise}const n={keys:t,equal:s.equal,remove:()=>{const r=e.indexOf(n);-1!==r&&e.splice(r,1)},promise:(isPromise(r)?r:r(...t)).then((e=>{n.response=e;s.lifespan&&s.lifespan>0&&(n.timeout=setTimeout(n.remove,s.lifespan))})).catch((e=>n.error=e))};e.push(n);if(!o)throw n.promise}const suspend=(e,r,t)=>query(e,r,false,t);const preload=(e,r,t)=>{query(e,r,true,t)};const peek=r=>{var t;return null==(t=e.find((e=>shallowEqualArrays(r,e.keys,e.equal))))?void 0:t.response};const clear=r=>{if(void 0===r||0===r.length)e.splice(0,e.length);else{const t=e.find((e=>shallowEqualArrays(r,e.keys,e.equal)));t&&t.remove()}};export{clear,peek,preload,suspend};

